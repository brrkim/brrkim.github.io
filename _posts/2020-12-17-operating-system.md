---
title: "가상 메모리"
date: 2020-12-17 08:26:28 -0400
marp: true
categories: OS 운영체제 가상메모리 페이징
---

# 1. 운영체제

## 1.1. 

## 1.5. 가상 메모리

### 1.5.1. 가상 메모리 개념

- 배경
  - 실제 각 프로세스 마다 충분한 메모리를 할당하기에는 메모리 크기 한계가 있음
  - 예를 들면 리눅스는 하나의 프로세스가 4GB
  - 따라서, 어떻게하면 적은 메모리로 여러 프로세스를 실행 시킬 수 있도록 구조를 가져갈지 고민
- 필요 이유
  - 가상 메모리 없으면 하나의 프로세스만 실행 가능한 시스템임 (배치 처리 시스템 등)
  - 여러 프로세스 동시 실행 시스템은  아래 이슈 발생
    - 이슈
      - 메모리 용량 부족 이슈 발생
      - 프로세스 메모리 영역 간 침범 이슈
    - 따라서 가상 메모리 필요
- 기술 설명
  - 메모리가 실제 메모리보다 많아 보이게 하는 기술
    - 실제 사용하는 메모리는 작다는 점에서 착안
      - 예를 들어, 프로세스에 4GB를 할당하나 실제 물리 메모리에 올라가는 것은 그것보다 작음
    - 프로세스간 공간 분리로 프로세스 이슈가 전체 시스템에 영향 주지 않음
- 특징
  - ![image-20201217005631783](C:\Users\ghk92\AppData\Roaming\Typora\typora-user-images\image-20201217005631783.png)
  - 프로세스는 가상 주소를 사용하고, 실제 해당 주소에서 데이터를 읽고 쓸때만 물리 주소로 바꿔주면 된다
    - virtual address (가상 주소): 프로세스가 참조하는 주소
    - physical address (물리 주소): 실제 메모리 주소
    - 가상주소를 물리주소로 변환시켜주는 메커니즘이 들어있음
      - MMU(Memory Management Unit) 이라는 하드웨어 장치가 수행
      - ![image-20201217010331902](C:\Users\ghk92\AppData\Roaming\Typora\typora-user-images\image-20201217010331902.png)

### 1.5.2 페이징 시스템

- 가상 메모리 만들기 위해 가장 많이 쓰이는 메커니즘

- 개념

  - 크기가 동일한 페이지로 가상 주소 공간과 이에 매칭하는 물리 주소 공간을 관리
  - 하드웨어 지원 필요 - 인텔 32bit 시스템에서는 4KB, 2MB, 1GB 단위 지원
  - 리눅스에서는 4KB로 페이징
  - 페이지번호로 가상 주소 / 물리 주소 매핑 정보를 기록하고 사용함

- 예시

  - 프로세스(4GB)의 PCB(process control block)에 Page Table 구조체를 가리키는 주소 있음
  - Page Table에는 가상 주소와 물리 주소간 매핑 정보 있음
  - ![image-20201217011032780](C:\Users\ghk92\AppData\Roaming\Typora\typora-user-images\image-20201217011032780.png)

- 구조

  - page 또는 page frame: 고정된 크기의 block (4KB)

    (참고) 프로세스 단위 (4GB = 2^32 in 32bit 시스템)

  - 가상 주소 v = (p, d)

    - p: 가상 메모리 페이지 (페이지 번호)
    - d: 페이지 처음부터 얼마 떨어진 위치인지 (변위)

  - 가상 페이지 번호 p가 Page Table에 물리주소 번호와 매핑이 되고, 이 물리주소 번호에 변위 d 만큼 더하면 실제 물리 메모리 주소가 되는 것임 

  - ![image-20201217012158226](C:\Users\ghk92\AppData\Roaming\Typora\typora-user-images\image-20201217012158226.png)

- Page Table

  - 물리 주소에 있는 페이지 번호와 해당 페이지의 첫 물리 주소 정보 매핑한 표

  - CPU가 해당 프로세스에서 특정 가상 주소 엑세스 하려면

    - 해당 프로세스의 page table에 해당 가상 주소가 포함된 페이지 번호(p)가 있는지 확인

    - 페이지 번호가 있으면 이 page가 매핑된 물리주소를 알아내고(p')

    - p' + d가 실제 물리 메모리의 데이터위치(주소) 가 됨

      (정리) 프로세스 PCB에 page table의 base주소 가져오기 + 페이지번호를 가지고 Page Table에서 해당 Page로 들어갈 수 있음

  - ![image-20201217013446466](C:\Users\ghk92\AppData\Roaming\Typora\typora-user-images\image-20201217013446466.png)

  - Page Table에는 valid-invalid bit 가 있어서 물리 주소에 데이터가 들어있는지 비어있는지도 알 수 있음

  - ![image-20201217013634248](C:\Users\ghk92\AppData\Roaming\Typora\typora-user-images\image-20201217013634248.png)

- 페이징 시스템과 MMU

  - 프로세스 생성 시 페이지 테이블 정보 생성
  - PCB 등에서 해당 페이지 테이블 접근 가능하고, 관련 정보는 물리 메모리에 적재
  - 프로세스구동시, 해당 페이지 테이블 base 주소가 별도 레지스터에 저장 (CR3)
  - CPU가 가상 주소 접근 시, MMU가 페이지 테이블 base 주소를 접근해서 물리 주소를 가져온다.

